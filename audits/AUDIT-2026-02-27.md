# Audit: Documentation Site Gaps

**Date**: 2026-02-27
**Scope**: Documentation site (`docs/`) — missing pages, stub content, outdated information
**Baseline**: 929 workspace tests passing, 75 integration tests, 31 MDX pages (9 stubs)
**Site**: https://docs.achrony.me (Astro + Starlight, bilingual EN/ES)

---

## Summary

The docs site has solid coverage in Language Reference, Circuit Programming, ZK Concepts, and CLI Reference. However, 9 out of 31 pages are empty stubs ("Content coming soon"), key reference pages are missing entirely, and 2 pages contain outdated data.

---

## Findings

| ID | Severity | Category | Description | File | Status |
|----|----------|----------|-------------|------|--------|
| D-01 | High | Stub | Architecture: Pipeline Overview — empty | `architecture/pipeline.mdx` | To fix |
| D-02 | High | Stub | Architecture: Crate Map — empty | `architecture/crate-map.mdx` | To fix |
| D-03 | High | Stub | Architecture: IR & Optimization — empty | `architecture/ir-and-optimization.mdx` | To fix |
| D-04 | High | Stub | Architecture: Backends — empty | `architecture/backends.mdx` | To fix |
| D-05 | High | Stub | Architecture: Witness Generation — empty | `architecture/witness-generation.mdx` | To fix |
| D-06 | Medium | Stub | Architecture: Extension Guide — empty | `architecture/extension-guide.mdx` | To fix |
| D-07 | Medium | Stub | Tutorial: Merkle Membership Proof — empty | `tutorials/merkle-proof.mdx` | To fix |
| D-08 | Medium | Stub | Tutorial: Inline Proofs — empty | `tutorials/inline-proofs.mdx` | To fix |
| D-09 | Medium | Stub | Tutorial: Poseidon Hashing — empty | `tutorials/poseidon-hashing.mdx` | To fix |
| D-10 | High | Missing | No Native Functions Reference page — 23 natives undocumented in site | — | To fix |
| D-11 | Medium | Missing | No Error Handling & Debugging page — line-number tracking undocumented | — | To fix |
| D-12 | Low | Missing | No VM & Bytecode page — 40 opcodes, tagged values, `.achb` format undocumented | — | To fix |
| D-13 | Low | Missing | No Memory & GC page — heap arenas, mark-sweep, stress mode undocumented | — | To fix |
| D-14 | Medium | Outdated | `introduction.mdx:92` says "718 unit tests + 54 integration tests" — actual is 929 + 75 | `getting-started/introduction.mdx` | To fix |
| D-15 | Low | Outdated | `introduction.mdx:96` says "3 security audits resolved" — actual is 6 | `getting-started/introduction.mdx` | To fix |

---

## Detailed Analysis

### Stubs: Architecture Section (D-01 to D-06)

All 6 pages in the Architecture section contain only `Content coming soon.` These are essential for contributors and advanced users who need to understand internals.

**D-01: Pipeline Overview** — Should document the full compilation pipeline: source → PEG parser → AST → (bytecode path | IR path) → (R1CS | Plonkish) → binary export / native proof. Reference: `README.md` pipeline diagram and `ARCHITECTURE.md`.

**D-02: Crate Map** — Should document the 7 workspace crates (`achronyme-parser`, `ir`, `compiler`, `vm`, `memory`, `constraints`, `cli`), their dependency graph, and key entry points. Reference: root `Cargo.toml` workspace members.

**D-03: IR & Optimization** — Should document `SsaVar(u32)`, 18 `Instruction` variants, `IrProgram`, `IrLowering`, and the 4 optimization passes (`const_fold`, `dce`, `bool_prop`, `taint`). Reference: `ir/src/types.rs`, `ir/src/passes/`.

**D-04: Backends** — Should document how IR instructions map to R1CS constraints vs Plonkish gates/lookups. Constraint costs, `PlonkVal` lazy materialization, `materialize_lc`. Reference: `compiler/src/r1cs_backend.rs`, `compiler/src/plonkish_backend.rs`.

**D-05: Witness Generation** — Should document `WitnessOp` enum, `WitnessGenerator::from_compiler()`, replay-based generation, `fill_poseidon` allocation order. Reference: `compiler/src/witness_gen.rs`.

**D-06: Extension Guide** — Should provide step-by-step instructions for adding: a new IR instruction, a new circuit builtin, a new optimization pass, a new VM opcode or native function. Lower priority since this is contributor-facing.

---

### Stubs: Tutorials (D-07 to D-09)

**D-07: Merkle Membership Proof** — End-to-end tutorial: define circuit with `merkle_verify`, compute Poseidon hashes for path, compile with `ach circuit`, verify with snarkjs. Include concrete inputs and expected outputs.

**D-08: Inline Proofs** — Tutorial: capture variables in `prove {}`, generate Groth16 proof, extract with `proof_json`/`proof_public`/`proof_vkey`, verify with `verify_proof()`. Cover `--prove-backend plonkish` variant.

**D-09: Poseidon Hashing** — Tutorial: compute `poseidon(a, b)` in VM mode, build hash chains with `poseidon_many`, compute Merkle roots manually, verify circomlibjs compatibility.

---

### Missing Pages (D-10 to D-13)

**D-10: Native Functions Reference** — The 23 VM native functions need a dedicated reference page. Currently scattered across README and circuit builtins page. Should include: function signature, parameter types, return type, which modes support it (VM/circuit/both), and examples.

Natives to document:
| # | Function | Arity | Mode |
|---|----------|-------|------|
| 0 | `print(...)` | variadic | VM |
| 1 | `len(x)` | 1 | Both |
| 2 | `typeof(x)` | 1 | VM |
| 3 | `assert(x)` | 1 | Both |
| 4 | `time()` | 0 | VM |
| 5 | `push(list, item)` | 2 | VM |
| 6 | `pop(list)` | 1 | VM |
| 7 | `keys(map)` | 1 | VM |
| 8 | `field(x)` | 1 | VM |
| 9 | `proof_json(p)` | 1 | VM |
| 10 | `proof_public(p)` | 1 | VM |
| 11 | `proof_vkey(p)` | 1 | VM |
| 12 | `substring(s, start, end)` | 3 | VM |
| 13 | `indexOf(s, sub)` | 2 | VM |
| 14 | `split(s, delim)` | 2 | VM |
| 15 | `trim(s)` | 1 | VM |
| 16 | `replace(s, search, repl)` | 3 | VM |
| 17 | `toUpper(s)` | 1 | VM |
| 18 | `toLower(s)` | 1 | VM |
| 19 | `chars(s)` | 1 | VM |
| 20 | `poseidon(a, b)` | 2 | Both |
| 21 | `poseidon_many(a, b, ...)` | variadic | Both |
| 22 | `verify_proof(p)` | 1 | VM |

**D-11: Error Handling & Debugging** — Should document: runtime error types (`IntegerOverflow`, `DivisionByZero`, `TypeMismatch`, `IndexOutOfBounds`, etc.), error format with line numbers (`[line N] in func: ErrorKind`), circuit-mode compile errors, taint analysis warnings (`UnderConstrained`, `UnusedInput`), debugging strategies.

**D-12: VM & Bytecode** — Should document: register-based architecture, 40 opcodes by category, instruction encoding (ABC/ABx formats), tagged u64 value representation (13 tags), `.achb` binary format, constant pool.

**D-13: Memory & GC** — Should document: typed arenas (strings, lists, maps, functions, closures, upvalues, iterators, fields, proofs), mark-and-sweep algorithm, GC roots (stack, globals, open upvalues, constants), `--stress-gc` testing mode.

---

### Outdated Content (D-14, D-15)

**D-14**: `getting-started/introduction.mdx` line 92 states:
```
- 718 unit tests + 54 integration tests
```
Actual count: **929 unit tests + 75 integration tests**.

**D-15**: Same file line 96 states:
```
- 3 security audits resolved
```
Actual count: **6 security audits** (`audits/AUDIT-2026-02-2{1..6}.md`).

---

## Priority Order

### Immediate (outdated data)
1. D-14, D-15 — Fix test count and audit count in `introduction.mdx`

### High (empty architecture stubs)
2. D-01 — Pipeline Overview
3. D-02 — Crate Map
4. D-03 — IR & Optimization
5. D-04 — Backends
6. D-05 — Witness Generation
7. D-10 — Native Functions Reference (new page)

### Medium (tutorials + missing pages)
8. D-08 — Tutorial: Inline Proofs
9. D-07 — Tutorial: Merkle Membership Proof
10. D-09 — Tutorial: Poseidon Hashing
11. D-11 — Error Handling & Debugging (new page)

### Low (contributor-facing)
12. D-06 — Extension Guide
13. D-12 — VM & Bytecode (new page)
14. D-13 — Memory & GC (new page)

---

## Verification

After fixes, verify:
```sh
cd docs && npm run build   # ensure all pages render without errors
```

Check that no pages contain "Content coming soon" placeholder text:
```sh
grep -r "coming soon" docs/src/content/docs/
```
